sudo: required
dist: xenial
language: python
python:
  - '3.5'
  - '3.6'
  - '3.7'
install:
  - pip install .
  - pip install -r requirements.txt
script: python setup.py test
jobs:
  include:
    - stage: deploy
      addons:
        apt:
          sources:
            - sourceline: 'deb https://download.docker.com/linux/ubuntu/ xenial stable'
              key_url: 'https://download.docker.com/linux/ubuntu/gpg'
          packages:
            - docker-ce
            - docker-ce-cli
            - containerd.io
      language: python
      python: '3.6'
      script:
        - export DOCKER_CLI_EXPERIMENTAL=enabled
        - docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
        - docker buildx create --use
        - docker buildx build --progress plain --platform linux/amd64,linux/arm64,linux/arm/v7 -t batvanyovanistia/pai .
